generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enum 정의
enum Gender {
  MALE
  FEMALE
}

enum Mbti {
  INTJ
  INTP
  ENTJ
  ENTP
  INFJ
  INFP
  ENFJ
  ENFP
  ISTJ
  ISFJ
  ESTJ
  ESFJ
  ISTP
  ISFP
  ESTP
  ESFP
}

enum PlantStatus {
  Seed
  Germination
  Seedling
  Mature
}

enum Authority {
  ADMIN
  MANAGER
  MEMBER
}

// User 모델
model User {
  userKey            Int                  @id @default(autoincrement())
  userId             String               @unique
  userName           String
  userPassword       String
  userEmail          String
  gender             Gender
  birth              DateTime
  role               String?
  mbti               Mbti?
  plantDicts         PlantDict[]          // 1:N 관계
  projects           ProjectInfo[]        // N:M 관계
  taskTables         TaskTable[]          // 1:N 관계
  privateCalendar    PrivateCalendar?     // 1:1 관계
  PlantDictPlantLink PlantDictPlantLink[] // N:M 관계
}

// PlantDict 모델
model PlantDict {
  dictKey    Int                  @id @default(autoincrement())
  getDate    DateTime
  getPlace   String
  userKey    Int
  user       User                 @relation(fields: [userKey], references: [userKey], onDelete: Cascade)
  plantLinks PlantDictPlantLink[]
}

// MultiTable 모델
model PlantDictPlantLink {
  linkKey          Int        @id @default(autoincrement())
  userKey          Int
  plantKey         Int
  user             User       @relation(fields: [userKey], references: [userKey], onDelete: Cascade)
  plant            Plant      @relation(fields: [plantKey], references: [plantKey], onDelete: Cascade)
  PlantDict        PlantDict? @relation(fields: [plantDictDictKey], references: [dictKey])
  plantDictDictKey Int?
}

// Plant 모델
model Plant {
  plantKey    Int                  @id @default(autoincrement())
  plantName   String
  plantStatus PlantStatus
  projects    Project[]
  plantLinks  PlantDictPlantLink[]
}

// TaskTable 모델
model TaskTable {
  taskKey         Int              @id @default(autoincrement())
  taskName        String
  taskProgress    String
  taskStartDate   DateTime
  taskEndDate     DateTime
  userKey         Int
  projectKey      Int
  projectCalendarKey Int?
  user            User             @relation(fields: [userKey], references: [userKey], onDelete: Cascade)
  project         Project          @relation(fields: [projectKey], references: [projectKey], onDelete: Cascade)
  projectCalendar ProjectCalendar? @relation(fields: [projectCalendarKey], references: [projectCalKey], onDelete: SetNull)
}

model Schedule {
  scheduleKey       Int              @id @default(autoincrement())
  calendarDate      DateTime?      
  scheduleDetails   String?      
  privateCalKey     Int?            
  privateCalendar   PrivateCalendar? @relation(fields: [privateCalKey], references: [privateCalendarKey], onDelete: Cascade)

  projectCalKey     Int?
  projectCalendar   ProjectCalendar? @relation(fields: [projectCalKey], references: [projectCalKey], onDelete: Cascade)
}

model Memo {
  memoKey           Int              @id @default(autoincrement())
  content           String?       

  privateCalKey     Int?             
  privateCalendar   PrivateCalendar?   @relation(fields: [privateCalKey], references: [privateCalendarKey], onDelete: Cascade)

  projectCalKey     Int?
  projectCalendar   ProjectCalendar? @relation(fields: [projectCalKey], references: [projectCalKey], onDelete: Cascade)
}

// ProjectCalendar 모델
model ProjectCalendar {
  projectCalKey   Int              @id @default(autoincrement())
  calendarDate    DateTime?
  projectKey      Int              @unique
  project         Project          @relation(fields: [projectKey], references: [projectKey], onDelete: Cascade)
  taskTables      TaskTable[]
  memos           Memo[]          
  schedules       Schedule[]   

  privateCalendars PrivateCalendar[] @relation("UserProjectCalendars")
}

// ProjectInfo 모델
model ProjectInfo {
  projectInfoKey Int       @id @default(autoincrement())
  userKey        Int
  projectKey     Int
  importance     Boolean
  authority      Authority
  user           User      @relation(fields: [userKey], references: [userKey], onDelete: Cascade)
  project        Project   @relation(fields: [projectKey], references: [projectKey], onDelete: Cascade)
}

// PrivateCalendar 모델
model PrivateCalendar {
  privateCalendarKey Int               @id @default(autoincrement())
  userKey            Int               @unique // 수정: 1:1 관계
  calendarDate       DateTime?
  user               User              @relation(fields: [userKey], references: [userKey], onDelete: Cascade)
  
  projectCalendars   ProjectCalendar[] @relation("UserProjectCalendars")
  projects           Project[]
  schedules          Schedule[]      
  memos              Memo[] 
}

// Project 모델
model Project {
  projectKey      Int              @id @default(autoincrement())
  totalPeople     Int
  totalProgress   Int
  startDate       DateTime
  endDate         DateTime
  projectName     String
  taskCount       Int
  plantKey        Int?             // 1:1 관계
  privateCalKey   Int?
  currentProgress String
  taskTables      TaskTable[]
  projectCalendar ProjectCalendar[] 
  privateCalendar PrivateCalendar? @relation(fields: [privateCalKey], references: [privateCalendarKey], onDelete: SetNull)
  plant           Plant?           @relation(fields: [plantKey], references: [plantKey], onDelete: SetNull)
  projectInfos    ProjectInfo[]
}
